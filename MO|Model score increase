{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/akokoo/mo-model-score-increase?scriptVersionId=172822163\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"2d5980d4","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2024-04-19T08:14:41.783544Z","iopub.status.busy":"2024-04-19T08:14:41.783195Z","iopub.status.idle":"2024-04-19T08:14:43.801013Z","shell.execute_reply":"2024-04-19T08:14:43.800039Z"},"papermill":{"duration":2.026776,"end_time":"2024-04-19T08:14:43.803579","exception":false,"start_time":"2024-04-19T08:14:41.776803","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","from sklearn.feature_extraction.text import CountVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.linear_model import LogisticRegression\n","from sklearn.metrics import accuracy_score, classification_report"]},{"cell_type":"code","execution_count":2,"id":"cdf16ada","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:43.814621Z","iopub.status.busy":"2024-04-19T08:14:43.813657Z","iopub.status.idle":"2024-04-19T08:14:43.90645Z","shell.execute_reply":"2024-04-19T08:14:43.905241Z"},"papermill":{"duration":0.10048,"end_time":"2024-04-19T08:14:43.908743","exception":false,"start_time":"2024-04-19T08:14:43.808263","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["                                                 text  label\n","0   rt @user olha quem chegouuuuu, nossos queridin...      0\n","1   veio umas teorias muito loucas na minha cabeça...      1\n","2   @user @user 😂😂😂😂mais nao tinha falado ontem qu...      0\n","3   rt @user quer ser filha da puta logo comigo qu...      1\n","4            vai besta 😂😂😂😂 casquei com a ultima foto      1\n","5   rt @user @user não sei oq é mais chocante, um ...      1\n","6          @user pois é mano que coisa chata da porra      0\n","7   rt @user eu odeio sentir ódio de alguém pq eu ...      1\n","8   se eu ganhar raspo minha cabeça\\n https://t.co...      0\n","9                  rt @user @user vlw mano tmj 鉂ゐ煉煆�      0\n","10  rt @user mulher que é mulher não discuti por h...      0\n","11                    @user bicho eu fico puto demais      0\n","12  @user deve ser um peso, mas chorar faz parte d...      0\n","13  rt @user eu to puto so queria ser prioridade n...      1\n","14  eu lembro quando a pérola era tímida e quieta,...      0\n","15   puta merda, que saudade de jogar midnight club 3      1\n","16  rt @user você eh fraco stuart liro, lhe falta ...      0\n","17  @user vai se ferrar af desgraçada de perfeita ...      0\n","18                   blz perdi o onibus kkkkkkkkk vsf      1\n","19  Há um mistério há anos, desde a criação do Min...      0\n"]}],"source":["train_data= pd.read_csv('/kaggle/input/ml-olympiad-toxic-language-ptbr-detection/train (2).csv')\n","print(train_data.head(20))"]},{"cell_type":"code","execution_count":3,"id":"48139cd8","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:43.918969Z","iopub.status.busy":"2024-04-19T08:14:43.918628Z","iopub.status.idle":"2024-04-19T08:14:43.924281Z","shell.execute_reply":"2024-04-19T08:14:43.923347Z"},"papermill":{"duration":0.013312,"end_time":"2024-04-19T08:14:43.926529","exception":false,"start_time":"2024-04-19T08:14:43.913217","status":"completed"},"tags":[]},"outputs":[],"source":["X = train_data['text']\n","y = train_data['label']"]},{"cell_type":"code","execution_count":4,"id":"9bae0875","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:43.937245Z","iopub.status.busy":"2024-04-19T08:14:43.936549Z","iopub.status.idle":"2024-04-19T08:14:44.474229Z","shell.execute_reply":"2024-04-19T08:14:44.473046Z"},"papermill":{"duration":0.545874,"end_time":"2024-04-19T08:14:44.476805","exception":false,"start_time":"2024-04-19T08:14:43.930931","status":"completed"},"tags":[]},"outputs":[],"source":["#转文本\n","vectorizer = CountVectorizer()\n","X_vectorized = vectorizer.fit_transform(X)"]},{"cell_type":"code","execution_count":5,"id":"501e1969","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.487998Z","iopub.status.busy":"2024-04-19T08:14:44.487073Z","iopub.status.idle":"2024-04-19T08:14:44.500279Z","shell.execute_reply":"2024-04-19T08:14:44.49917Z"},"papermill":{"duration":0.021136,"end_time":"2024-04-19T08:14:44.50262","exception":false,"start_time":"2024-04-19T08:14:44.481484","status":"completed"},"tags":[]},"outputs":[],"source":["X_train, X_val, y_train, y_val = train_test_split(X_vectorized, y, test_size=0.2, random_state=42)\n","# model = LogisticRegression(max_iter=1000)\n","# model.fit(X_train, y_train)"]},{"cell_type":"code","execution_count":6,"id":"d593642b","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.51358Z","iopub.status.busy":"2024-04-19T08:14:44.512743Z","iopub.status.idle":"2024-04-19T08:14:44.517216Z","shell.execute_reply":"2024-04-19T08:14:44.516249Z"},"papermill":{"duration":0.012835,"end_time":"2024-04-19T08:14:44.519862","exception":false,"start_time":"2024-04-19T08:14:44.507027","status":"completed"},"tags":[]},"outputs":[],"source":["# y_pred = model.predict(X_val)\n","# accuracy = accuracy_score(y_val, y_pred)\n","# print(\"\\n模型验证结果:\")\n","# print(\"准确率:\", accuracy)\n","# print(\"\\n分类报告:\")\n","# print(classification_report(y_val, y_pred))"]},{"cell_type":"code","execution_count":7,"id":"5f7f684f","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.531272Z","iopub.status.busy":"2024-04-19T08:14:44.530506Z","iopub.status.idle":"2024-04-19T08:14:44.534677Z","shell.execute_reply":"2024-04-19T08:14:44.533759Z"},"papermill":{"duration":0.011902,"end_time":"2024-04-19T08:14:44.536806","exception":false,"start_time":"2024-04-19T08:14:44.524904","status":"completed"},"tags":[]},"outputs":[],"source":["# test_data = pd.read_csv('/kaggle/input/ml-olympiad-toxic-language-ptbr-detection/test (4).csv')"]},{"cell_type":"code","execution_count":8,"id":"40f3362b","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.547563Z","iopub.status.busy":"2024-04-19T08:14:44.546839Z","iopub.status.idle":"2024-04-19T08:14:44.550981Z","shell.execute_reply":"2024-04-19T08:14:44.550123Z"},"papermill":{"duration":0.011765,"end_time":"2024-04-19T08:14:44.553129","exception":false,"start_time":"2024-04-19T08:14:44.541364","status":"completed"},"tags":[]},"outputs":[],"source":["# X_test = vectorizer.transform(test_data['text'])\n","# test_predictions = model.predict(X_test)\n","# submission_df = pd.DataFrame({'id': test_data['id'], 'label': test_predictions})\n","# submission_df.to_csv('submission.csv', index=False)"]},{"cell_type":"code","execution_count":9,"id":"039d050b","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.56426Z","iopub.status.busy":"2024-04-19T08:14:44.563496Z","iopub.status.idle":"2024-04-19T08:14:44.568356Z","shell.execute_reply":"2024-04-19T08:14:44.567414Z"},"papermill":{"duration":0.012709,"end_time":"2024-04-19T08:14:44.570435","exception":false,"start_time":"2024-04-19T08:14:44.557726","status":"completed"},"tags":[]},"outputs":[],"source":["# from sklearn.model_selection import GridSearchCV\n","\n","# param_grid = {'C': [0.01, 0.1, 1, 10, 100],\n","#               'solver': ['newton-cg', 'lbfgs', 'liblinear', 'sag', 'saga'],\n","#              'max_iter': [100, 200, 300, 400, 500]}\n","\n","# # 初始化逻辑回归模型\n","# log_reg = LogisticRegression(max_iter=1000)\n","\n","# # 参数搜索\n","# grid_search = GridSearchCV(log_reg, param_grid, cv=5, scoring='accuracy')\n","# grid_search.fit(X_train, y_train)\n","\n","# print(\"最佳参数:\", grid_search.best_params_)\n","\n","# best_model = grid_search.best_estimator_\n","# best_model.fit(X_train, y_train)\n","\n","# # 验证最佳模型\n","# y_pred_best = best_model.predict(X_val)\n","# accuracy_best = accuracy_score(y_val, y_pred_best)\n","# print(\"\\n调参后模型验证结果:\")\n","# print(\"准确率:\", accuracy_best)\n","# print(\"\\n分类报告:\")\n","# print(classification_report(y_val, y_pred_best))"]},{"cell_type":"code","execution_count":10,"id":"4af5e7fa","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:44.583736Z","iopub.status.busy":"2024-04-19T08:14:44.583264Z","iopub.status.idle":"2024-04-19T08:14:46.299228Z","shell.execute_reply":"2024-04-19T08:14:46.298011Z"},"papermill":{"duration":1.726768,"end_time":"2024-04-19T08:14:46.30246","exception":false,"start_time":"2024-04-19T08:14:44.575692","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["/opt/conda/lib/python3.10/site-packages/sklearn/linear_model/_sag.py:350: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge\n","  warnings.warn(\n"]},{"data":{"text/html":["<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: \"▸\";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: \"▾\";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: \"\";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id=\"sk-container-id-1\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>LogisticRegression(C=1, max_iter=300, solver=&#x27;saga&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-1\" type=\"checkbox\" checked><label for=\"sk-estimator-id-1\" class=\"sk-toggleable__label sk-toggleable__label-arrow\">LogisticRegression</label><div class=\"sk-toggleable__content\"><pre>LogisticRegression(C=1, max_iter=300, solver=&#x27;saga&#x27;)</pre></div></div></div></div></div>"],"text/plain":["LogisticRegression(C=1, max_iter=300, solver='saga')"]},"execution_count":10,"metadata":{},"output_type":"execute_result"}],"source":["# NEW model\n","best_model = LogisticRegression(C=1, max_iter=300, solver='saga')\n","best_model.fit(X_train, y_train)\n"]},{"cell_type":"code","execution_count":11,"id":"03cc8757","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:46.313352Z","iopub.status.busy":"2024-04-19T08:14:46.312992Z","iopub.status.idle":"2024-04-19T08:14:46.333478Z","shell.execute_reply":"2024-04-19T08:14:46.33207Z"},"papermill":{"duration":0.028309,"end_time":"2024-04-19T08:14:46.335691","exception":false,"start_time":"2024-04-19T08:14:46.307382","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["\n","调参后模型验证结果:\n","准确率: 0.7580357142857143\n","\n","分类报告:\n","              precision    recall  f1-score   support\n","\n","           0       0.77      0.81      0.79      1881\n","           1       0.74      0.70      0.72      1479\n","\n","    accuracy                           0.76      3360\n","   macro avg       0.76      0.75      0.75      3360\n","weighted avg       0.76      0.76      0.76      3360\n","\n"]}],"source":["y_pred_best = best_model.predict(X_val)\n","accuracy_best = accuracy_score(y_val, y_pred_best)\n","print(\"\\n调参后模型验证结果:\")\n","print(\"准确率:\", accuracy_best)\n","print(\"\\n分类报告:\")\n","print(classification_report(y_val, y_pred_best))"]},{"cell_type":"code","execution_count":12,"id":"d6519030","metadata":{"execution":{"iopub.execute_input":"2024-04-19T08:14:46.347282Z","iopub.status.busy":"2024-04-19T08:14:46.346388Z","iopub.status.idle":"2024-04-19T08:14:46.478445Z","shell.execute_reply":"2024-04-19T08:14:46.47737Z"},"papermill":{"duration":0.140188,"end_time":"2024-04-19T08:14:46.480739","exception":false,"start_time":"2024-04-19T08:14:46.340551","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["over\n"]}],"source":["test_data = pd.read_csv('/kaggle/input/ml-olympiad-toxic-language-ptbr-detection/test (4).csv')\n","\n","X_test = vectorizer.transform(test_data['text'])\n","test_predictions = best_model.predict(X_test)  \n","\n","submission_df = pd.DataFrame({'id': test_data['id'], 'label': test_predictions})\n","submission_df.to_csv('submission.csv', index=False)\n","print('over')"]}],"metadata":{"kaggle":{"accelerator":"gpu","dataSources":[{"databundleVersionId":7798918,"sourceId":71348,"sourceType":"competition"}],"dockerImageVersionId":30665,"isGpuEnabled":true,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.13"},"papermill":{"default_parameters":{},"duration":8.20602,"end_time":"2024-04-19T08:14:47.106354","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-04-19T08:14:38.900334","version":"2.5.0"}},"nbformat":4,"nbformat_minor":5}